# ğŸ´ æ‰‘å…‹ç‰Œæ¸¸æˆé¡¹ç›® - æ¶æ„è¯´æ˜å’Œå¼€å‘æŒ‡å—

## ğŸ“Š é¡¹ç›®æ¶æ„æ€»è§ˆ

```
å‰ç«¯ (React)
    â†“
Zustand Store (çŠ¶æ€ç®¡ç†)
    â†“
Supabase Client (æ•°æ®åº“å®¢æˆ·ç«¯)
    â†“
Supabase Realtime (å®æ—¶åŒæ­¥)
    â†“
PostgreSQL (æ•°æ®åº“)
```

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1. **é€šç”¨æ•°æ®ç»“æ„ + çµæ´»æ¸¸æˆè§„åˆ™**

æ•°æ®åº“è¡¨ç»“æ„æ˜¯**é€šç”¨çš„**ï¼Œä¸ç»‘å®šä»»ä½•å…·ä½“æ¸¸æˆè§„åˆ™ï¼š

```javascript
// âœ… é€šç”¨ï¼šé€‚ç”¨äºä»»ä½•æ‰‘å…‹æ¸¸æˆ
{
  game_state: {...},      // JSONï¼šå­˜å‚¨ä»»ä½•æ¸¸æˆçŠ¶æ€
  player_state: {...},    // JSONï¼šå­˜å‚¨ä»»ä½•ç©å®¶çŠ¶æ€
  hand: [...],            // JSONï¼šå­˜å‚¨æ‰‹ç‰Œ
}

// âŒ ä¸å¥½ï¼šç»‘å®šåˆ°å…·ä½“æ¸¸æˆ
{
  is_landlord: true,      // åªé€‚ç”¨äºæ–—åœ°ä¸»
  chips: 1000,            // åªé€‚ç”¨äºå¾·å·æ‰‘å…‹
}
```

**ä¼˜åŠ¿**ï¼š

- âœ… å¯ä»¥éšæ—¶æ›´æ¢æ¸¸æˆè§„åˆ™
- âœ… å¯ä»¥åŒæ—¶æ”¯æŒå¤šç§æ¸¸æˆ
- âœ… æ•°æ®åº“ç»“æ„ç¨³å®šï¼Œä¸éœ€è¦é¢‘ç¹ä¿®æ”¹

### 2. **å‰ç«¯å¤„ç†æ¸¸æˆé€»è¾‘**

æ¸¸æˆè§„åˆ™é€»è¾‘åœ¨**å‰ç«¯**å®ç°ï¼ˆ`src/utils/gameLogic.js`ï¼‰ï¼Œåç«¯åªè´Ÿè´£å­˜å‚¨æ•°æ®ã€‚

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

- âœ… ä½ ä¸éœ€è¦å­¦ä¹ åç«¯æ¡†æ¶
- âœ… å¼€å‘å’Œè°ƒè¯•æ›´ç®€å•
- âœ… é€‚åˆå°å‹å¤šäººæ¸¸æˆ

**æ˜¯å¦å®‰å…¨ï¼Ÿ**

- åŸºç¡€ç‰ˆæœ¬ï¼šä½¿ç”¨ Supabase RLSï¼ˆRow Level Securityï¼‰é™åˆ¶æ•°æ®è®¿é—®
- è¿›é˜¶ç‰ˆæœ¬ï¼šå¯ä»¥æ·»åŠ æœåŠ¡ç«¯éªŒè¯ï¼ˆSupabase Edge Functionsï¼‰

---

## ğŸ“ æ–‡ä»¶ç»“æ„å’ŒèŒè´£

### æ ¸å¿ƒæ–‡ä»¶

```
src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ supabase.js              [é…ç½®] Supabase è¿æ¥
â”‚
â”œâ”€â”€ store/
â”‚   â””â”€â”€ gameStore.js             [çŠ¶æ€] æ¸¸æˆçŠ¶æ€ç®¡ç†
â”‚                                 - åˆ›å»º/åŠ å…¥æ¸¸æˆ
â”‚                                 - å®æ—¶åŒæ­¥
â”‚                                 - æ¸¸æˆæ“ä½œï¼ˆå‘ç‰Œã€å‡ºç‰Œç­‰ï¼‰
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ cardUtils.js             [å·¥å…·] æ‰‘å…‹ç‰Œé€šç”¨å‡½æ•°
â”‚   â”‚                             - åˆ›å»ºç‰Œå †
â”‚   â”‚                             - æ´—ç‰Œ
â”‚   â”‚                             - å‘ç‰Œ
â”‚   â”‚                             - æ’åº
â”‚   â”‚
â”‚   â””â”€â”€ gameLogic.js             [è§„åˆ™] æ¸¸æˆè§„åˆ™é€»è¾‘ â­ï¸
â”‚                                 ğŸ® è¿™é‡Œæ˜¯ä½ å®ç°å…·ä½“æ¸¸æˆè§„åˆ™çš„åœ°æ–¹ï¼
â”‚                                 - å‘ç‰Œè§„åˆ™
â”‚                                 - å‡ºç‰ŒéªŒè¯
â”‚                                 - è·èƒœåˆ¤å®š
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Card/                    [UI] å•å¼ æ‰‘å…‹ç‰Œæ˜¾ç¤º
â”‚   â”œâ”€â”€ Lobby/                   [UI] å¤§å…ï¼ˆåˆ›å»º/åŠ å…¥æˆ¿é—´ï¼‰
â”‚   â””â”€â”€ GameRoom/                [UI] æ¸¸æˆæˆ¿é—´ä¸»ç•Œé¢
â”‚
â””â”€â”€ App.jsx                      [è·¯ç”±] åº”ç”¨è·¯ç”±é…ç½®
```

---

## ğŸ® å®ç°å…·ä½“æ¸¸æˆè§„åˆ™çš„æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¡®å®šæ¸¸æˆè§„åˆ™

ä¸¾ä¾‹ï¼šå®ç°"æ–—åœ°ä¸»"æ¸¸æˆ

```javascript
// src/utils/gameLogic.js

export const GAME_CONFIG = {
  MIN_PLAYERS: 3, // æ–—åœ°ä¸»éœ€è¦3äºº
  MAX_PLAYERS: 3,
  CARDS_PER_PLAYER: 17, // æ¯äºº17å¼ 
  USE_JOKERS: true, // ä½¿ç”¨å¤§å°ç‹
  LEFTOVER_CARDS: 3, // åº•ç‰Œ3å¼ 
};
```

### ç¬¬äºŒæ­¥ï¼šå®šä¹‰æ¸¸æˆçŠ¶æ€

```javascript
static initGameState(playerCount) {
  return {
    phase: 'bidding',         // å«åœ°ä¸»é˜¶æ®µ
    landlordId: null,         // åœ°ä¸»ID
    currentBid: 0,            // å½“å‰å«åˆ†
    bottomCards: [],          // åº•ç‰Œ
    lastPlay: null,           // ä¸Šä¸€æ¬¡å‡ºç‰Œ
    passCount: 0,             // è¿ç»­è¿‡ç‰Œæ¬¡æ•°
  }
}
```

### ç¬¬ä¸‰æ­¥ï¼šå®ç°æ ¸å¿ƒé€»è¾‘

```javascript
// 1. å«åœ°ä¸»é€»è¾‘
static bid(playerId, bidAmount, gameState) {
  // å®ç°å«åœ°ä¸»é€»è¾‘
}

// 2. å‡ºç‰ŒéªŒè¯
static canPlayCard(cards, lastPlay, gameState) {
  // æ£€æŸ¥ç‰Œå‹æ˜¯å¦åˆæ³•
  // æ£€æŸ¥æ˜¯å¦èƒ½å‹è¿‡ä¸Šå®¶
}

// 3. åˆ¤æ–­è·èƒœ
static checkGameEnd(players, gameState) {
  const landlord = players.find(p => p.id === gameState.landlordId)
  if (landlord.hand.length === 0) {
    return { winner: 'landlord', ... }
  }
  // ... å…¶ä»–åˆ¤æ–­
}
```

---

## ğŸ”„ æ•°æ®æµç¨‹å›¾

### åˆ›å»ºæ¸¸æˆæµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºæˆ¿é—´"
   â†“
2. gameStore.createGame()
   â†“
3. ç”Ÿæˆæˆ¿é—´å· â†’ æ’å…¥ games è¡¨
   â†“
4. åˆ›å»ºç©å®¶ â†’ æ’å…¥ players è¡¨
   â†“
5. è®¢é˜…å®æ—¶æ›´æ–° â†’ subscribeToGame()
   â†“
6. è·³è½¬åˆ°æ¸¸æˆæˆ¿é—´é¡µé¢
```

### å‡ºç‰Œæµç¨‹

```
1. ç”¨æˆ·é€‰æ‹©å¡ç‰Œ â†’ ç‚¹å‡»"å‡ºç‰Œ"
   â†“
2. gameStore.playCard(card)
   â†“
3. è°ƒç”¨ gameLogic.canPlayCard() éªŒè¯
   â†“
4. éªŒè¯é€šè¿‡ â†’ æ›´æ–° Supabase
   - æ›´æ–° players.handï¼ˆç§»é™¤å‡ºçš„ç‰Œï¼‰
   - æ›´æ–° games.game_stateï¼ˆè®°å½•åŠ¨ä½œï¼‰
   - æ’å…¥ game_actionsï¼ˆè®°å½•å†å²ï¼‰
   â†“
5. Supabase Realtime æ¨é€å˜åŒ–
   â†“
6. æ‰€æœ‰ç©å®¶æ”¶åˆ°æ›´æ–° â†’ UI è‡ªåŠ¨åˆ·æ–°
```

### å®æ—¶åŒæ­¥åŸç†

```
ç©å®¶A                     Supabase                    ç©å®¶B
  |                          |                          |
  |--- å‡ºç‰Œ (æ›´æ–°æ•°æ®åº“) ---->|                          |
  |                          |                          |
  |                          |------- Realtime æ¨é€ ---->|
  |                          |                          |
  |<------ ç¡®è®¤æ›´æ–° ---------|                          |
  |                          |                          |
  |                          |<------ ç•Œé¢æ›´æ–° ---------|
```

---

## ğŸ› ï¸ ä¿®æ”¹å’Œæ‰©å±•æŒ‡å—

### åœºæ™¯ 1ï¼šä¿®æ”¹ç©å®¶æ•°é‡

```javascript
// src/utils/gameLogic.js
export const GAME_CONFIG = {
  MIN_PLAYERS: 2, // æ”¹ä¸º2äºº
  MAX_PLAYERS: 6, // æ”¹ä¸º6äºº
};
```

### åœºæ™¯ 2ï¼šæ·»åŠ å¤§å°ç‹

```javascript
export const GAME_CONFIG = {
  USE_JOKERS: true, // æ”¹ä¸º true
};
```

### åœºæ™¯ 3ï¼šä¿®æ”¹æ¯äººæ‰‹ç‰Œæ•°é‡

```javascript
export const GAME_CONFIG = {
  CARDS_PER_PLAYER: 7, // æ”¹ä¸ºæ¯äºº7å¼ 
};
```

### åœºæ™¯ 4ï¼šæ·»åŠ èŠå¤©åŠŸèƒ½

1. åˆ›å»º `messages` è¡¨ï¼š

```sql
create table messages (
  id uuid default gen_random_uuid() primary key,
  game_id uuid references games(id),
  player_id uuid references players(id),
  content text not null,
  created_at timestamp with time zone default now()
);
```

2. åœ¨ `gameStore.js` æ·»åŠ å‘é€æ¶ˆæ¯æ–¹æ³•
3. åœ¨ `GameRoom` ç»„ä»¶æ·»åŠ èŠå¤© UI

### åœºæ™¯ 5ï¼šæ·»åŠ éŸ³æ•ˆ

```javascript
// src/utils/sounds.js
export const playCardSound = () => {
  const audio = new Audio("/sounds/card.mp3");
  audio.play();
};

// åœ¨å‡ºç‰Œæ—¶è°ƒç”¨
handlePlayCard = () => {
  playCardSound();
  // ... å…¶ä»–é€»è¾‘
};
```

---

## ğŸ¨ UI è‡ªå®šä¹‰

### ä¿®æ”¹æ‰‘å…‹ç‰Œæ ·å¼

ç¼–è¾‘ `src/components/Card/index.module.less`ï¼š

```less
.card {
  width: 80px; // ä¿®æ”¹å®½åº¦
  height: 120px; // ä¿®æ”¹é«˜åº¦
  // ... å…¶ä»–æ ·å¼
}
```

### ä¿®æ”¹ä¸»é¢˜é¢œè‰²

ç¼–è¾‘ `src/components/Lobby/index.module.less` ç­‰ï¼š

```less
.lobby {
  background: linear-gradient(135deg, #ä½ çš„é¢œè‰²1, #ä½ çš„é¢œè‰²2);
}
```

---

## ğŸš€ éƒ¨ç½²åˆ° Vercel

### æ­¥éª¤

1. **æ¨é€ä»£ç åˆ° GitHub**

```bash
git add .
git commit -m "Add poker game"
git push
```

2. **åœ¨ Vercel å¯¼å…¥é¡¹ç›®**

- è®¿é—® https://vercel.com
- ç‚¹å‡» "Import Project"
- é€‰æ‹©ä½ çš„ GitHub ä»“åº“

3. **é…ç½®ç¯å¢ƒå˜é‡**
   åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š

- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`

4. **éƒ¨ç½²**
   ç‚¹å‡» "Deploy"ï¼Œç­‰å¾…å®Œæˆ

5. **åˆ†äº«é“¾æ¥**
   éƒ¨ç½²å®Œæˆåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç½‘å€ï¼ˆå¦‚ `https://your-app.vercel.app`ï¼‰
   æœ‹å‹è®¿é—® `https://your-app.vercel.app/poker` å³å¯æ¸¸æˆ

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‡å°‘æ•°æ®åº“æŸ¥è¯¢

```javascript
// âŒ ä¸å¥½ï¼šé¢‘ç¹æŸ¥è¯¢
setInterval(() => {
  fetchPlayers();
}, 1000);

// âœ… å¥½ï¼šä½¿ç”¨ Realtime è®¢é˜…
subscribeToGame(gameId);
```

### 2. ä¼˜åŒ– Realtime è®¢é˜…

```javascript
// åªè®¢é˜…éœ€è¦çš„å­—æ®µ
.select('id, nickname, hand')  // ä¸æ˜¯ select('*')
```

### 3. æ·»åŠ åŠ è½½çŠ¶æ€

```javascript
const [loading, setLoading] = useState(false);

// æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
{
  loading && <div>å¤„ç†ä¸­...</div>;
}
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹ Supabase æ•°æ®

Supabase Dashboard â†’ Table Editor â†’ æŸ¥çœ‹å®é™…æ•°æ®

### 2. æŸ¥çœ‹ Realtime æ¶ˆæ¯

```javascript
.on('postgres_changes', ..., (payload) => {
  console.log('æ”¶åˆ°æ›´æ–°:', payload)  // æ·»åŠ æ—¥å¿—
})
```

### 3. æŸ¥çœ‹æ¸¸æˆçŠ¶æ€

åœ¨ç»„ä»¶ä¸­æ·»åŠ ï¼š

```javascript
console.log("å½“å‰æ¸¸æˆçŠ¶æ€:", game);
console.log("å½“å‰ç©å®¶åˆ—è¡¨:", players);
```

---

## ğŸ“š æ¨èå­¦ä¹ èµ„æº

- **Supabase æ–‡æ¡£**: https://supabase.com/docs
- **Zustand æ–‡æ¡£**: https://docs.pmnd.rs/zustand
- **React Router æ–‡æ¡£**: https://reactrouter.com

---

## âœ¨ é¡¹ç›®ç‰¹ç‚¹æ€»ç»“

### âœ… ä½ ä¸éœ€è¦å­¦ä¹ çš„å†…å®¹

- âŒ åç«¯æ¡†æ¶ï¼ˆExpressã€NestJS ç­‰ï¼‰
- âŒ WebSocket æœåŠ¡å™¨æ­å»º
- âŒ æ•°æ®åº“éƒ¨ç½²å’Œè¿ç»´
- âŒ æœåŠ¡å™¨é…ç½®

### âœ… ä½ åªéœ€è¦å…³æ³¨

- âœ… React ç»„ä»¶å¼€å‘ï¼ˆä½ å·²ç»ä¼šäº†ï¼‰
- âœ… æ¸¸æˆè§„åˆ™é€»è¾‘ï¼ˆJavaScriptï¼‰
- âœ… Supabase åŸºç¡€æ“ä½œï¼ˆå¾ˆç®€å•ï¼‰

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

- å¿«é€Ÿå¼€å‘ï¼Œä¸“æ³¨æ¸¸æˆé€»è¾‘
- å®æ—¶åŒæ­¥å¼€ç®±å³ç”¨
- å…è´¹éƒ¨ç½²ï¼ˆVercel + Supabaseï¼‰
- å®¹æ˜“æ‰©å±•å’Œç»´æŠ¤

---

## ğŸ‰ å¼€å§‹å¼€å‘å§ï¼

ç°åœ¨ä½ å·²ç»äº†è§£äº†æ•´ä¸ªé¡¹ç›®çš„æ¶æ„ï¼Œå¯ä»¥å¼€å§‹ï¼š

1. å…ˆè·‘é€šåŸºç¡€æµç¨‹ï¼ˆåˆ›å»ºæˆ¿é—´ã€åŠ å…¥æˆ¿é—´ã€å‘ç‰Œï¼‰
2. ç¡®å®šä½ æƒ³åšä»€ä¹ˆæ¸¸æˆ
3. åœ¨ `src/utils/gameLogic.js` å®ç°å…·ä½“è§„åˆ™
4. æµ‹è¯•ã€ä¼˜åŒ–ã€ç¾åŒ–
5. éƒ¨ç½²ç»™æœ‹å‹ä¸€èµ·ç©ï¼

æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶æŸ¥çœ‹æ–‡æ¡£æˆ–åœ¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ã€‚ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€
